<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="pandoc">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="This book will teach you how to program in R, with hands-on examples. I wrote it for non-programmers to provide a friendly introduction to the R language. You’ll learn how to load data, assemble and disassemble data objects, navigate R’s environment system, write your own functions, and use all of R’s programming tools. Throughout the book, you’ll use your newfound skills to solve practical data science problems.">
<title>Hands-On Programming with R – 8&nbsp; S3</title>
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007ba5; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #007ba5; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #007ba5; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
<!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]--><script src="site_libs/quarto-nav/quarto-nav.js"></script><script src="site_libs/quarto-nav/headroom.min.js"></script><meta name="quarto:offset" content=".">
<script src="site_libs/quarto-search/autocomplete.min.js"></script><script src="site_libs/quarto-search/fuse.min.js"></script><script src="site_libs/quarto-search/quarto-search.js"></script><script src="site_libs/quarto-html/popper.min.js"></script><script src="site_libs/quarto-html/tippy.umd.min.js"></script><script src="site_libs/quarto-html/clipboard.min.js"></script><script src="site_libs/quarto-html/anchor.min.js"></script><script src="site_libs/quarto-html/quarto-html.js"></script><link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<script src="site_libs/bootstrap/bootstrap.min.js"></script><link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
</head>
<body data-bs-spy="scroll" data-bs-target="#quarto-toc-sidebar">
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-5 d-inline">8&nbsp; S3</h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav></header><!-- /navbar/sidebar --><div class="container-fluid quarto-container d-flex flex-column" id="quarto-content">
<div class="row flex-fill">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="ms-lg-auto py-2 floating  overflow-scroll "><div class="px-3 pt-lg-3 text-center">
    <h4 class="sidebar-title text-center mt-1 mb-0 py-0">Hands-On Programming with R</h4>
      <div class="sidebar-tools-main mt-1">
    <a href="https://github.com/jjallaire/hopr/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item" href="http://www.twitter.com/share">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item" href="https://www.facebook.com/sharer/sharer.php">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item" href="https://www.linkedin.com/sharing/share-offsite/?url=">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
  </div>
    <div class="d-flex px-3 mt-2">
      <div class="sidebar-search flex-fill">
      <form class="d-flex mb-0">
  <input id="quarto-search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
      </div>
        <div class="sidebar-tools-collapse mt-1">
    <a href="https://github.com/jjallaire/hopr/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item" href="http://www.twitter.com/share">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item" href="https://www.facebook.com/sharer/sharer.php">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item" href="https://www.linkedin.com/sharing/share-offsite/?url=">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-3 px-3">
<li class="sidebar-item">
  <a href="./index.html" class="">Welcome</a>
</li>
      <li class="sidebar-item">
  <a href="./preface.html" class="">Preface</a>
</li>
      <ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto ">
            <a href="./dice.html" class="">Project 1: Weighted Dice</a>
            </div>
            <button class="btn text-start  " data-bs-toggle="collapse" data-bs-target="#project1weighteddice-collapse" aria-expanded=" true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </button>
            </div>
      <div class="collapse  show" id="project1weighteddice-collapse">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href="./basics.html" class=""><span class="chapter-number">1</span>&nbsp; The Very Basics</a>
</li>
          <li class="sidebar-item">
  <a href="./packages.html" class=""><span class="chapter-number">2</span>&nbsp; Packages and Help Pages</a>
</li>
        </ul>
</div>
    </div>
</li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto ">
            <a href="./cards.html" class="">Project 2: Playing Cards</a>
            </div>
            <button class="btn text-start  " data-bs-toggle="collapse" data-bs-target="#project2playingcards-collapse" aria-expanded=" true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </button>
            </div>
      <div class="collapse  show" id="project2playingcards-collapse">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href="./objects.html" class=""><span class="chapter-number">3</span>&nbsp; R Objects</a>
</li>
          <li class="sidebar-item">
  <a href="./notation.html" class=""><span class="chapter-number">4</span>&nbsp; R Notation</a>
</li>
          <li class="sidebar-item">
  <a href="./modifying.html" class=""><span class="chapter-number">5</span>&nbsp; Modifying Values</a>
</li>
          <li class="sidebar-item">
  <a href="./environments.html" class=""><span class="chapter-number">6</span>&nbsp; Environments</a>
</li>
        </ul>
</div>
    </div>
</li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto ">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto ">
            <a href="./slots.html" class="">Project 3: Slot Machine</a>
            </div>
            <button class="btn text-start  " data-bs-toggle="collapse" data-bs-target="#project3slotmachine-collapse" aria-expanded=" true">
              <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </button>
            </div>
      <div class="collapse  show" id="project3slotmachine-collapse">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href="./programs.html" class=""><span class="chapter-number">7</span>&nbsp; Programs</a>
</li>
          <li class="sidebar-item">
  <a href="./s3.html" class="active"><span class="chapter-number">8</span>&nbsp; S3</a>
</li>
          <li class="sidebar-item">
  <a href="./loops.html" class=""><span class="chapter-number">9</span>&nbsp; Loops</a>
</li>
          <li class="sidebar-item">
  <a href="./speed.html" class=""><span class="chapter-number">10</span>&nbsp; Speed</a>
</li>
        </ul>
</div>
    </div>
</li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto ">
            <button class="btn sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#appendices-collapse" aria-expanded=" true">
              <div class="me-auto  sidebar-section-item">
                Appendices
              </div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </button>
      <div class="collapse  show" id="appendices-collapse">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href="./a1-starting.html" class=""><span class="chapter-number">A</span>&nbsp; Installing R and RStudio</a>
</li>
          <li class="sidebar-item">
  <a href="./a2-packages.html" class=""><span class="chapter-number">B</span>&nbsp; R Packages</a>
</li>
          <li class="sidebar-item">
  <a href="./a3-updating.html" class=""><span class="chapter-number">C</span>&nbsp; Updating R and Its Packages</a>
</li>
          <li class="sidebar-item">
  <a href="./a4-data.html" class=""><span class="chapter-number">D</span>&nbsp; Loading and Saving Data in R</a>
</li>
          <li class="sidebar-item">
  <a href="./a5-debug.html" class=""><span class="chapter-number">E</span>&nbsp; Debugging R Code</a>
</li>
        </ul>
</div>
    </div>
</li>
  </ul>
</ul>
</div>
</nav>
</div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-7 px-lg-4">
<main><header id="title-block-header"><h1 class="title d-none d-lg-block display-6">8&nbsp; S3</h1>
</header><p>You may have noticed that your slot machine results do not look the way I promised they would. I suggested that the slot machine would display its results like this:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="co">## 0 0 DD</span>
<span class="co">## $0</span></code></pre></div>
<p>But the current machine displays its results in a less pretty format:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="co">## "0"  "0" "DD" </span>
<span class="co">## 0</span></code></pre></div>
<p>Moreover, the slot machine uses a hack to display symbols (we call <code>print</code> from within <code>play</code>). As a result, the symbols do not follow your prize output if you save it:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">one_play</span> <span class="op">&lt;-</span> <span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="co">## "B" "0" "B" </span>

<span class="va">one_play</span>
<span class="co">## 0</span></code></pre></div>
<p>You can fix both of these problems with R’s S3 system.</p>
<section class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" id="the-s3-system">
<span class="header-section-number">8.1</span> The S3 System</h2>
<p>S3 refers to a class system built into R. The system governs how R handles objects of different classes. Certain R functions will look up an object’s S3 class, and then behave differently in response.</p>
<p>The <code>print</code> function is like this. When you print a numeric vector, <code>print</code> will display a number:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">1000000000</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span>
<span class="co">## 1000000000</span></code></pre></div>
<p>But if you give that number the S3 class <code>POSIXct</code> followed by <code>POSIXt</code>, <code>print</code> will display a time:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"POSIXct"</span>, <span class="st">"POSIXt"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span>
<span class="co">## "2001-09-08 19:46:40 CST"</span></code></pre></div>
<p>If you use objects with classes—and you do—you will run into R’s S3 system. S3 behavior can seem odd at first, but is easy to predict once you are familiar with it.</p>
<p>R’s S3 system is built around three components: attributes (especially the <code>class</code> attribute), generic functions, and methods.</p>
</section><section class="level2" data-number="8.2"><h2 data-number="8.2" class="anchored" id="attributes">
<span class="header-section-number">8.2</span> Attributes</h2>
<p>In <a href="objects.html#sec:attributes">Attributes</a>, you learned that many R objects come with attributes, pieces of extra information that are given a name and appended to the object. Attributes do not affect the values of the object, but stick to the object as a type of metadata that R can use to handle the object. For example, a data frame stores its row and column names as attributes. Data frames also store their class, <code>"data.frame"</code>, as an attribute.</p>
<p>You can see an object’s attributes with <code>attribute</code>. If you run <code>attribute</code> on the <code>deck</code> data frame that you created in <a href="cards.html">Project 2: Playing Cards</a>, you will see:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">deck</span><span class="op">)</span>
<span class="co">## $names</span>
<span class="co">## [1] "face"  "suit"  "value"</span>
<span class="co">## </span>
<span class="co">## $class</span>
<span class="co">## [1] "data.frame"</span>
<span class="co">## </span>
<span class="co">## $row.names</span>
<span class="co">##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 </span>
<span class="co">## [20] 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36</span>
<span class="co">## [37] 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52</span></code></pre></div>
<p>R comes with many helper functions that let you set and access the most common attributes used in R. You’ve already met the <code>names</code>, <code>dim</code>, and <code>class</code> functions, which each work with an eponymously named attribute. However, R also has <code>row.names</code>, <code>levels</code>, and many other attribute-based helper functions. You can use any of these functions to retrieve an attribute’s value:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">deck</span><span class="op">)</span>
<span class="co">##  [1] "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12" "13"</span>
<span class="co">## [14] "14" "15" "16" "17" "18" "19" "20" "21" "22" "23" "24" "25" "26"</span>
<span class="co">## [27] "27" "28" "29" "30" "31" "32" "33" "34" "35" "36" "37" "38" "39"</span>
<span class="co">## [40] "40" "41" "42" "43" "44" "45" "46" "47" "48" "49" "50" "51" "52"</span></code></pre></div>
<p>or to change an attribute’s value:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">deck</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">101</span><span class="op">:</span><span class="fl">152</span></code></pre></div>
<p>or to give an object a new attribute altogether:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">deck</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"level 1"</span>, <span class="st">"level 2"</span>, <span class="st">"level 3"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">deck</span><span class="op">)</span>
<span class="co">## $names</span>
<span class="co">## [1] "face"  "suit"  "value"</span>
<span class="co">## </span>
<span class="co">## $class</span>
<span class="co">## [1] "data.frame"</span>
<span class="co">## </span>
<span class="co">## $row.names</span>
<span class="co">##  [1] 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117</span>
<span class="co">## [18] 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134</span>
<span class="co">## [35] 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151</span>
<span class="co">## [52] 152</span>
<span class="co">## </span>
<span class="co">## $levels</span>
<span class="co">## [1] "level 1" "level 2" "level 3"</span></code></pre></div>
<p>R is very laissez faire when it comes to attributes. It will let you add any attributes that you like to an object (and then it will usually ignore them). The only time R will complain is when a function needs to find an attribute and it is not there.</p>
<p>You can add any general attribute to an object with <code>attr</code>; you can also use <code>attr</code> to look up the value of any attribute of an object. Let’s see how this works with <code>one_play</code>, the result of playing our slot machine one time:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">one_play</span> <span class="op">&lt;-</span> <span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="va">one_play</span>
<span class="co">## 0</span>

<span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">one_play</span><span class="op">)</span>
<span class="co">## NULL</span></code></pre></div>
<p><code>attr</code> takes two arguments: an R object and the name of an attribute (as a character string). To give the R object an attribute of the specified name, save a value to the output of <code>attr</code>. Let’s give <code>one_play</code> an attribute named <code>symbols</code> that contains a vector of character strings:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">one_play</span>, <span class="st">"symbols"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"0"</span>, <span class="st">"B"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">one_play</span><span class="op">)</span>
<span class="co">## $symbols</span>
<span class="co">## [1] "B" "0" "B"</span></code></pre></div>
<p>To look up the value of any attribute, give <code>attr</code> an R object and the name of the attribute you would like to look up:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">one_play</span>, <span class="st">"symbols"</span><span class="op">)</span>
<span class="co">## "B" "0" "B"</span></code></pre></div>
<p>If you give an attribute to an atomic vector, like <code>one_play</code>, R will usually display the attribute beneath the vector’s values. However, if the attribute changes the vector’s class, R may display all of the information in the vector in a new way (as we saw with <code>POSIXct</code> objects):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">one_play</span>
<span class="co">## [1] 0</span>
<span class="co">## attr(,"symbols")</span>
<span class="co">## [1] "B" "0" "B"</span></code></pre></div>
<p>R will generally ignore an object’s attributes unless you give them a name that an R function looks for, like <code>names</code> or <code>class</code>. For example, R will ignore the <code>symbols</code> attribute of <code>one_play</code> as you manipulate <code>one_play</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">one_play</span> <span class="op">+</span> <span class="fl">1</span>
<span class="co">##  1</span>
<span class="co">## attr(,"symbols")</span>
<span class="co">##  "B" "0" "B"</span></code></pre></div>
<div class="callout callout no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="flex-fill">
Exercise: Add an Attribute
</div>
</div>
<div class="callout-body">
<p>Modify <code>play</code> to return a prize that contains the symbols associated with it as an attribute named <code>symbols</code>. Remove the redundant call to <code><a href="https://rdrr.io/r/base/print.html">print(symbols)</a></code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">play</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu">get_symbols</span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span>
  <span class="fu">score</span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<p>You can create a new version of <code>play</code> by capturing the output of <code>score(symbols)</code> and assigning an attribute to it. <code>play</code> can then return the enhanced version of the output:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">play</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu">get_symbols</span><span class="op">(</span><span class="op">)</span>
  <span class="va">prize</span> <span class="op">&lt;-</span> <span class="fu">score</span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">prize</span>, <span class="st">"symbols"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">symbols</span>
  <span class="va">prize</span>
<span class="op">}</span></code></pre></div>
<p>Now <code>play</code> returns both the prize and the symbols associated with the prize. The results may not look pretty, but the symbols stick with the prize when we copy it to a new object. We can work on tidying up the display in a minute:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="co">## [1] 0</span>
<span class="co">## attr(,"symbols")</span>
<span class="co">## [1] "B"  "BB" "0" </span>
 
<span class="va">two_play</span> <span class="op">&lt;-</span> <span class="fu">play</span><span class="op">(</span><span class="op">)</span>
 
<span class="va">two_play</span>
<span class="co">## [1] 0</span>
<span class="co">## attr(,"symbols")</span>
<span class="co">## [1] "0" "B" "0"</span></code></pre></div>
<p>You can also generate a prize and set its attributes in one step with the <code>structure</code> function. <code>structure</code> creates an object with a set of attributes. The first argument of <code>structure</code> should be an R object or set of values, and the remaining arguments should be named attributes for <code>structure</code> to add to the object. You can give these arguments any argument names you like. <code>structure</code> will add the attributes to the object under the names that you provide as argument names:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">play</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu">get_symbols</span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span><span class="op">(</span><span class="fu">score</span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span>, symbols <span class="op">=</span> <span class="va">symbols</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">three_play</span> <span class="op">&lt;-</span> <span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="va">three_play</span>
<span class="co">##  0</span>
<span class="co">##  attr(,"symbols")</span>
<span class="co">##  "0"  "BB" "B" </span></code></pre></div>
<p>Now that your <code>play</code> output contains a <code>symbols</code> attribute, what can you do with it? You can write your own functions that lookup and use the attribute. For example, the following function will look up <code>one_play</code>’s <code>symbols</code> attribute and use it to display <code>one_play</code> in a pretty manner. We will use this function to display our slot results, so let’s take a moment to study what it does:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">slot_display</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prize</span><span class="op">)</span><span class="op">{</span>

  <span class="co"># extract symbols</span>
  <span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">prize</span>, <span class="st">"symbols"</span><span class="op">)</span>

  <span class="co"># collapse symbols into single string</span>
  <span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">symbols</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>

  <span class="co"># combine symbol with prize as a character string</span>
  <span class="co"># \n is special escape sequence for a new line (i.e. return or enter)</span>
  <span class="va">string</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">symbols</span>, <span class="va">prize</span>, sep <span class="op">=</span> <span class="st">"\n$"</span><span class="op">)</span>

  <span class="co"># display character string in console without quotes</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">string</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">slot_display</span><span class="op">(</span><span class="va">one_play</span><span class="op">)</span>
<span class="co">## B 0 B</span>
<span class="co">## $0</span></code></pre></div>
<p>The function expects an object like <code>one_play</code> that has both a numerical value and a <code>symbols</code> attribute. The first line of the function will look up the value of the <code>symbols</code> attribute and save it as an object named <code>symbols</code>. Let’s make an example <code>symbols</code> object so we can see what the rest of the function does. We can use <code>one_play</code>’s <code>symbols</code> attribute to do the job. <code>symbols</code> will be a vector of three-character strings:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">one_play</span>, <span class="st">"symbols"</span><span class="op">)</span>

<span class="va">symbols</span>
<span class="co">## "B" "0" "B"</span></code></pre></div>
<p>Next, <code>slot_display</code> uses <code>paste</code> to collapse the three strings in <code>symbols</code> into a single-character string. <code>paste</code> collapses a vector of character strings into a single string when you give it the <code>collapse</code> argument. <code>paste</code> will use the value of <code>collapse</code> to separate the formerly distinct strings. Hence, <code>symbols</code> becomes <code>B 0 B</code> the three strings separated by a space:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">symbols</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>

<span class="va">symbols</span>
<span class="co">## "B 0 B"</span></code></pre></div>
<p>Our function then uses <code>paste</code> in a new way to combine <code>symbols</code> with the value of <code>prize</code>. <code>paste</code> combines separate objects into a character string when you give it a <code>sep</code> argument. For example, here <code>paste</code> will combine the string in <code>symbols</code>, <code>B 0 B</code>, with the number in <code>prize</code>, 0. <code>paste</code> will use the value of <code>sep</code> argument to separate the inputs in the new string. Here, that value is <code>\n$</code>, so our result will look like <code>"B 0 B\n$0"</code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">prize</span> <span class="op">&lt;-</span> <span class="va">one_play</span>
<span class="va">string</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">symbols</span>, <span class="va">prize</span>, sep <span class="op">=</span> <span class="st">"\n$"</span><span class="op">)</span>

<span class="va">string</span>
<span class="co">## "B 0 B\n$0"</span></code></pre></div>
<p>The last line of <code>slot_display</code> calls <code>cat</code> on the new string. <code>cat</code> is like <code>print</code>; it displays its input at the command line. However, <code>cat</code> does not surround its output with quotation marks. <code>cat</code> also replaces every <code>\n</code> with a new line or line break. The result is what we see. Notice that it looks just how I suggested that our <code>play</code> output should look in [Programs]:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">string</span><span class="op">)</span>
<span class="co">## B 0 B</span>
<span class="co">## $0</span></code></pre></div>
<p>You can use <code>slot_display</code> to manually clean up the output of <code>play</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu">slot_display</span><span class="op">(</span><span class="fu">play</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">## C B 0</span>
<span class="co">## $2</span>

<span class="fu">slot_display</span><span class="op">(</span><span class="fu">play</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">## 7 0 BB</span>
<span class="co">## $0</span></code></pre></div>
<p>This method of cleaning the output requires you to manually intervene in your R session (to call <code>slot_display</code>). There is a function that you can use to automatically clean up the output of <code>play</code> <em>each</em> time it is displayed. This function is <code>print</code>, and it is a <em>generic function</em>.</p>
</section><section class="level2" data-number="8.3"><h2 data-number="8.3" class="anchored" id="generic-functions">
<span class="header-section-number">8.3</span> Generic Functions</h2>
<p>R uses <code>print</code> more often than you may think; R calls <code>print</code> each time it displays a result in your console window. This call happens in the background, so you do not notice it; but the call explains how output makes it to the console window (recall that <code>print</code> always prints its argument in the console window). This <code>print</code> call also explains why the output of <code>print</code> always matches what you see when you display an object at the command line:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span>
<span class="co">## 3.141593</span>

<span class="va">pi</span>
<span class="co">## 3.141593</span>


<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">deck</span><span class="op">)</span><span class="op">)</span>
<span class="co">##  face   suit value</span>
<span class="co">##  king spades    13</span>
<span class="co">## queen spades    12</span>
<span class="co">##  jack spades    11</span>
<span class="co">##   ten spades    10</span>
<span class="co">##  nine spades     9</span>
<span class="co">## eight spades     8</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">deck</span><span class="op">)</span>
<span class="co">##  face   suit value</span>
<span class="co">##  king spades    13</span>
<span class="co">## queen spades    12</span>
<span class="co">##  jack spades    11</span>
<span class="co">##   ten spades    10</span>
<span class="co">##  nine spades     9</span>
<span class="co">## eight spades     8</span>


<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">play</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">##  5</span>
<span class="co">## attr(,"symbols")</span>
<span class="co">##  "B"  "BB" "B" </span>

<span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="co">##  5</span>
<span class="co">## attr(,"symbols")</span>
<span class="co">##  "B"  "BB" "B" </span></code></pre></div>
<p>You can change how R displays your slot output by rewriting <code>print</code> to look like <code>slot_display</code>. Then R would print the output in our tidy format. However, this method would have negative side effects. You do not want R to call <code>slot_display</code> when it prints a data frame, a numerical vector, or any other object.</p>
<p>Fortunately, <code>print</code> is not a normal function; it is a <em>generic</em> function. This means that <code>print</code> is written in a way that lets it do different things in different cases. You’ve already seen this behavior in action (although you may not have realized it). <code>print</code> did one thing when we looked at the unclassed version of <code>num</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">1000000000</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span>
<span class="co">## 1000000000</span></code></pre></div>
<p>and a different thing when we gave <code>num</code> a class:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"POSIXct"</span>, <span class="st">"POSIXt"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span>
<span class="co">## "2001-09-08 19:46:40 CST"</span></code></pre></div>
<p>Take a look at the code inside <code>print</code> to see how it does this. You may imagine that print looks up the class attribute of its input and then uses an +if+ tree to pick which output to display. If this occurred to you, great job! <code>print</code> does something very similar, but much more simple.</p>
</section><section class="level2" data-number="8.4"><h2 data-number="8.4" class="anchored" id="methods">
<span class="header-section-number">8.4</span> Methods</h2>
<p>When you call <code>print</code>, <code>print</code> calls a special function, <code>UseMethod</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">print</span>
<span class="co">## function (x, ...) </span>
<span class="co">## UseMethod("print")</span>
<span class="co">## &lt;bytecode: 0x7ffee4c62f80&gt;</span>
<span class="co">## &lt;environment: namespace:base&gt;</span></code></pre></div>
<p><code>UseMethod</code> examines the class of the input that you provide for the first argument of <code>print</code>, and then passes all of your arguments to a new function designed to handle that class of input. For example, when you give <code>print</code> a POSIXct object, <code>UseMethod</code> will pass all of <code>print</code>’s arguments to <code>print.POSIXct</code>. R will then run <code>print.POSIXct</code> and return the results:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">print.POSIXct</span>
<span class="co">## function (x, ...) </span>
<span class="co">## {</span>
<span class="co">##     max.print &lt;- getOption("max.print", 9999L)</span>
<span class="co">##     if (max.print &lt; length(x)) {</span>
<span class="co">##         print(format(x[seq_len(max.print)], usetz = TRUE), ...)</span>
<span class="co">##         cat(" [ reached getOption(\"max.print\") -- omitted", </span>
<span class="co">##             length(x) - max.print, "entries ]\n")</span>
<span class="co">##     }</span>
<span class="co">##     else print(format(x, usetz = TRUE), ...)</span>
<span class="co">##     invisible(x)</span>
<span class="co">## }</span>
<span class="co">## &lt;bytecode: 0x7fa948f3d008&gt;</span>
<span class="co">## &lt;environment: namespace:base&gt;</span></code></pre></div>
<p>If you give <code>print</code> a factor object, <code>UseMethod</code> will pass all of <code>print</code>’s arguments to <code>print.factor</code>. R will then run <code>print.factor</code> and return the results:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">print.factor</span>
<span class="co">## function (x, quote = FALSE, max.levels = NULL, width = getOption("width"), </span>
<span class="co">##     ...) </span>
<span class="co">## {</span>
<span class="co">##     ord &lt;- is.ordered(x)</span>
<span class="co">##     if (length(x) == 0L) </span>
<span class="co">##         cat(if (ord) </span>
<span class="co">##             "ordered"</span>
<span class="co">## ...</span>
<span class="co">##         drop &lt;- n &gt; maxl</span>
<span class="co">##         cat(if (drop) </span>
<span class="co">##             paste(format(n), ""), T0, paste(if (drop) </span>
<span class="co">##             c(lev[1L:max(1, maxl - 1)], "...", if (maxl &gt; 1) lev[n])</span>
<span class="co">##         else lev, collapse = colsep), "\n", sep = "")</span>
<span class="co">##     }</span>
<span class="co">##     invisible(x)</span>
<span class="co">## }</span>
<span class="co">## &lt;bytecode: 0x7fa94a64d470&gt;</span>
<span class="co">## &lt;environment: namespace:base&gt;</span></code></pre></div>
<p><code>print.POSIXct</code> and <code>print.factor</code> are called <em>methods</em> of <code>print</code>. By themselves, <code>print.POSIXct</code> and <code>print.factor</code> work like regular R functions. However, each was written specifically so <code>UseMethod</code> could call it to handle a specific class of <code>print</code> input.</p>
<p>Notice that <code>print.POSIXct</code> and <code>print.factor</code> do two different things (also notice that I abridged the middle of <code>print.factor</code>—it is a long function). This is how <code>print</code> manages to do different things in different cases. <code>print</code> calls <code>UseMethod</code>, which calls a specialized method based on the class of <code>print</code>’s first argument.</p>
<p>You can see which methods exist for a generic function by calling <code>methods</code> on the function. For example, <code>print</code> has almost 200 methods (which gives you an idea of how many classes exist in R):</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span><span class="op">(</span><span class="va">print</span><span class="op">)</span>
<span class="co">##   [1] print.acf*                                   </span>
<span class="co">##   [2] print.anova                                  </span>
<span class="co">##   [3] print.aov*                                   </span>
<span class="co">##  ...                      </span>
<span class="co">## [176] print.xgettext*                              </span>
<span class="co">## [177] print.xngettext*                             </span>
<span class="co">## [178] print.xtabs*</span>
<span class="co">##</span>
<span class="co">##   Nonvisible functions are asterisked</span></code></pre></div>
<p>This system of generic functions, methods, and class-based dispatch is known as S3 because it originated in the third version of S, the programming language that would evolve into S-PLUS and R. Many common R functions are S3 generics that work with a set of class methods. For example, <code>summary</code> and <code>head</code> also call <code>UseMethod</code>. More basic functions, like <code>c</code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code>, <code><a href="https://rdrr.io/r/base/Comparison.html">&lt;</a></code> and others also behave like generic functions, although they call <code>.primitive</code> instead of <code>UseMethod</code>.</p>
<p>The S3 system allows R functions to behave in different ways for different classes. You can use S3 to format your slot output. First, give your output its own class. Then write a print method for that class. To do this efficiently, you will need to know a little about how <code>UseMethod</code> selects a method function to use.</p>
<section class="level3" data-number="8.4.1"><h3 data-number="8.4.1" class="anchored" id="method-dispatch">
<span class="header-section-number">8.4.1</span> Method Dispatch</h3>
<p><code>UseMethod</code> uses a very simple system to match methods to functions.</p>
<p>Every S3 method has a two-part name. The first part of the name will refer to the function that the method works with. The second part will refer to the class. These two parts will be separated by a period. So for example, the print method that works with functions will be called <code>print.function</code>. The summary method that works with matrices will be called <code>summary.matrix</code>. And so on.</p>
<p>When <code>UseMethod</code> needs to call a method, it searches for an R function with the correct S3-style name. The function does not have to be special in any way; it just needs to have the correct name.</p>
<p>You can participate in this system by writing your own function and giving it a valid S3-style name. For example, let’s give <code>one_play</code> a class of its own. It doesn’t matter what you call the class; R will store any character string in the class attribute:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">one_play</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"slots"</span></code></pre></div>
<p>Now let’s write an S3 print method for the +slots+ class. The method doesn’t need to do anything special—it doesn’t even need to print <code>one_play</code>. But it <em>does</em> need to be named <code>print.slots</code>; otherwise <code>UseMethod</code> will not find it. The method should also take the same arguments as <code>print</code>; otherwise, R will give an error when it tries to pass the arguments to <code>print.slots</code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/args.html">args</a></span><span class="op">(</span><span class="va">print</span><span class="op">)</span>
<span class="co">## function (x, ...) </span>
<span class="co">## NULL</span>

<span class="va">print.slots</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"I'm using the print.slots method"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Does our method work? Yes, and not only that; R uses the print method to display the contents of <code>one_play</code>. This method isn’t very useful, so I’m going to remove it. You’ll have a chance to write a better one in a minute:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">one_play</span><span class="op">)</span>
<span class="co">## I'm using the print.slots method</span>

<span class="va">one_play</span>
<span class="co">## I'm using the print.slots method</span>

<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">print.slots</span><span class="op">)</span></code></pre></div>
<p>Some R objects have multiple classes. For example, the output of <code>Sys.time</code> has two classes. Which class will <code>UseMethod</code> use to find a print method?</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">now</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">now</span><span class="op">)</span>
<span class="co">## $class</span>
<span class="co">## [1] "POSIXct" "POSIXt" </span></code></pre></div>
<p><code>UseMethod</code> will first look for a method that matches the first class listed in the object’s class vector. If <code>UseMethod</code> cannot find one, it will then look for the method that matches the second class (and so on if there are more classes in an object’s class vector).</p>
<p>If you give <code>print</code> an object whose class or classes do not have a print method, <code>UseMethod</code> will call <code>print.default</code>, a special method written to handle general cases.</p>
<p>Let’s use this system to write a better print method for the slot machine output.</p>
<div class="callout callout no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="flex-fill">
Exercise: Make a Print Method
</div>
</div>
<div class="callout-body">
<p>Write a new print method for the slots class. The method should call <code>slot_display</code> to return well-formatted slot-machine output.</p>
<p>What name must you use for this method?</p>
</div>
</div>
<p>It is surprisingly easy to write a good <code>print.slots</code> method because we’ve already done all of the hard work when we wrote <code>slot_display</code>. For example, the following method will work. Just make sure the method is named <code>print.slots</code> so <code>UseMethod</code> can find it, and make sure that it takes the same arguments as <code>print</code> so <code>UseMethod</code> can pass those arguments to <code>print.slots</code> without any trouble:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">print.slots</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">slot_display</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now R will automatically use <code>slot_display</code> to display objects of class +slots+ (and only objects of class “slots”):</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">one_play</span>
<span class="co">## B 0 B</span>
<span class="co">## $0</span></code></pre></div>
<p>Let’s ensure that every piece of slot machine output has the <code>slots</code> class.</p>
<div class="callout callout no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="flex-fill">
Exercise: Add a Class
</div>
</div>
<div class="callout-body">
<p>Modify the <code>play</code> function so it assigns <code>slots</code> to the <code>class</code> attribute of its output:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">play</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu">get_symbols</span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span><span class="op">(</span><span class="fu">score</span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span>, symbols <span class="op">=</span> <span class="va">symbols</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<p>You can set the <code>class</code> attribute of the output at the same time that you set the +symbols+ attribute. Just add <code>class = "slots"</code> to the <code>structure</code> call:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">play</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu">get_symbols</span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span><span class="op">(</span><span class="fu">score</span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span>, symbols <span class="op">=</span> <span class="va">symbols</span>, class <span class="op">=</span> <span class="st">"slots"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now each of our slot machine plays will have the class <code>slots</code>:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="fu">play</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">## "slots"</span></code></pre></div>
<p>As a result, R will display them in the correct slot-machine format:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="co">## BB BB BBB</span>
<span class="co">## $5</span>

<span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="co">## BB 0 0</span>
<span class="co">## $0</span></code></pre></div>
</section></section><section class="level2" data-number="8.5"><h2 data-number="8.5" class="anchored" id="classes">
<span class="header-section-number">8.5</span> Classes</h2>
<p>You can use the S3 system to make a robust new class of objects in R. Then R will treat objects of your class in a consistent, sensible manner. To make a class:</p>
<ul>
<li>Choose a name for your class.</li>
<li>Assign each instance of your class a +class+ attribute.</li>
<li>Write class methods for any generic function likely to use objects of your class.</li>
</ul>
<p>Many R packages are based on classes that have been built in a similar manner. While this work is simple, it may not be easy. For example, consider how many methods exist for predefined classes.</p>
<p>You can call <code>methods</code> on a class with the <code>class</code> argument, which takes a character string. <code>methods</code> will return every method written for the class. Notice that <code>methods</code> will not be able to show you methods that come in an unloaded R package:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"factor"</span><span class="op">)</span>
<span class="co">##  [1] [.factor             [[.factor           </span>
<span class="co">##  [3] [[&lt;-.factor          [&lt;-.factor          </span>
<span class="co">##  [5] all.equal.factor     as.character.factor </span>
<span class="co">##  [7] as.data.frame.factor as.Date.factor      </span>
<span class="co">##  [9] as.list.factor       as.logical.factor   </span>
<span class="co">## [11] as.POSIXlt.factor    as.vector.factor    </span>
<span class="co">## [13] droplevels.factor    format.factor       </span>
<span class="co">## [15] is.na&lt;-.factor       length&lt;-.factor     </span>
<span class="co">## [17] levels&lt;-.factor      Math.factor         </span>
<span class="co">## [19] Ops.factor           plot.factor*        </span>
<span class="co">## [21] print.factor         relevel.factor*     </span>
<span class="co">## [23] relist.factor*       rep.factor          </span>
<span class="co">## [25] summary.factor       Summary.factor      </span>
<span class="co">## [27] xtfrm.factor        </span>
<span class="co">## </span>
<span class="co">##    Nonvisible functions are asterisked</span></code></pre></div>
<p>This output indicates how much work is required to create a robust, well-behaved class. You will usually need to write a <code>class</code> method for every basic R operation.</p>
<p>Consider two challenges that you will face right away. First, R drops attributes (like <code>class</code>) when it combines objects into a vector:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">play1</span> <span class="op">&lt;-</span> <span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="va">play1</span>
<span class="co">## B BBB BBB</span>
<span class="co">## $5</span>

<span class="va">play2</span> <span class="op">&lt;-</span> <span class="fu">play</span><span class="op">(</span><span class="op">)</span>
<span class="va">play2</span>
<span class="co">## 0 B 0</span>
<span class="co">## $0</span>

<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">play1</span>, <span class="va">play2</span><span class="op">)</span>
<span class="co">## [1] 5 0</span></code></pre></div>
<p>Here, R stops using <code>print.slots</code> to display the vector because the vector <code><a href="https://rdrr.io/r/base/c.html">c(play1, play2)</a></code> no longer has a “slots” +class+ attribute.</p>
<p>Next, R will drop the attributes of an object (like <code>class</code>) when you subset the object:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r"><code class="sourceCode R"><span class="va">play1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="co">## [1] 5</span></code></pre></div>
<p>You can avoid this behavior by writing a <code>c.slots</code> method and a <code>[.slots</code> method, but then difficulties will quickly accrue. How would you combine the <code>symbols</code> attributes of multiple plays into a vector of symbols attributes? How would you change <code>print.slots</code> to handle vectors of outputs? These challenges are open for you to explore. However, you will usually not have to attempt this type of large-scale programming as a data scientist.</p>
<p>In our case, it is very handy to let <code>slots</code> objects revert to single prize values when we combine groups of them together into a vector.</p>
</section><section class="level2" data-number="8.6"><h2 data-number="8.6" class="anchored" id="s3-and-debugging">
<span class="header-section-number">8.6</span> S3 and Debugging</h2>
<p>S3 can be annoying if you are trying to understand R functions. It is difficult to tell what a function does if its code body contains a call to <code>UseMethod</code>. Now that you know that <code>UseMethod</code> calls a class-specific method, you can search for and examine the method directly. It will be a function whose name follows the <code>&lt;function.class&gt;</code> syntax, or possibly <code>&lt;function.default&gt;</code>. You can also use the <code>methods</code> function to see what methods are associated with a function or a class.</p>
</section><section class="level2" data-number="8.7"><h2 data-number="8.7" class="anchored" id="s4-and-r5">
<span class="header-section-number">8.7</span> S4 and R5</h2>
<p>R also contains two other systems that create class specific behavior. These are known as S4 and R5 (or reference classes). Each of these systems is much harder to use than S3, and perhaps as a consequence, more rare. However, they offer safeguards that S3 does not. If you’d like to learn more about these systems, including how to write and use your own generic functions, I recommend the book <a href="http://adv-r.had.co.nz/">Advanced R Programming</a> by Hadley Wickham.</p>
</section><section class="level2" data-number="8.8"><h2 data-number="8.8" class="anchored" id="summary">
<span class="header-section-number">8.8</span> Summary</h2>
<p>Values are not the only place to store information in R, and functions are not the only way to create unique behavior. You can also do both of these things with R’s S3 system. The S3 system provides a simple way to create object-specific behavior in R. In other words, it is R’s version of object-oriented programming (OOP). The system is implemented by generic functions. These functions examine the class attribute of their input and call a class-specific method to generate output. Many S3 methods will look for and use additional information that is stored in an object’s attributes. Many common R functions are S3 generics.</p>
<p>R’s S3 system is more helpful for the tasks of computer science than the tasks of data science, but understanding S3 can help you troubleshoot your work in R as a data scientist.</p>
<p>You now know quite a bit about how to write R code that performs custom tasks, but how could you repeat these tasks? As a data scientist, you will often repeat tasks, sometimes thousands or even millions of times. Why? Because repetition lets you simulate results and estimate probabilities. <a href="loops.html">Loops</a> will show you how to automate repetition with R’s <code>for</code> and <code>while</code> functions. You’ll use <code>for</code> to simulate various slot machine plays and to calculate the payout rate of your slot machine.</p>
<!-- -->
</section></main><div class="row page-navigation ">
  <div class="nav-page nav-page-previous col">
      <a href="./programs.html">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; Programs</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next col">
      <a href="./loops.html">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; Loops</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</div>
</div> <!-- /main column -->
<div id="quarto-toc-sidebar" class="col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc">
<nav id="TOC" role="doc-toc"><h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#the-s3-system" class="nav-link" data-bs-target="#the-s3-system"> <span class="header-section-number">8.1</span> The S3 System</a></li>
<li><a href="#attributes" class="nav-link" data-bs-target="#attributes"> <span class="header-section-number">8.2</span> Attributes</a></li>
<li><a href="#generic-functions" class="nav-link" data-bs-target="#generic-functions"> <span class="header-section-number">8.3</span> Generic Functions</a></li>
<li>
<a href="#methods" class="nav-link" data-bs-target="#methods"> <span class="header-section-number">8.4</span> Methods</a>
<ul>
<li><a href="#method-dispatch" class="nav-link" data-bs-target="#method-dispatch"> <span class="header-section-number">8.4.1</span> Method Dispatch</a></li>
</ul>
</li>
<li><a href="#classes" class="nav-link" data-bs-target="#classes"> <span class="header-section-number">8.5</span> Classes</a></li>
<li><a href="#s3-and-debugging" class="nav-link" data-bs-target="#s3-and-debugging"> <span class="header-section-number">8.6</span> S3 and Debugging</a></li>
<li><a href="#s4-and-r5" class="nav-link" data-bs-target="#s4-and-r5"> <span class="header-section-number">8.7</span> S4 and R5</a></li>
<li><a href="#summary" class="nav-link" data-bs-target="#summary"> <span class="header-section-number">8.8</span> Summary</a></li>
</ul>
<div class="toc-actions">
<div><i class="bi bi-github"></i></div>
<div class="action-links"><p><a href="https://github.com/jjallaire/hopr/edit/master/s3.Rmd">Edit this page</a></p></div>
</div></nav>
</div> <!-- /toc column -->
</div> <!-- /row -->
</div> <!-- /container fluid -->




</body></html>